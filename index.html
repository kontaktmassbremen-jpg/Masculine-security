<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Masculine Security â€” Dienstplan</title>
  <meta name="theme-color" content="#0b2a55"/>
  <style>
    :root{
      --bg:#061a33;
      --panel:#0b2a55;
      --panel2:#0d356a;
      --card:#0f3f7a;
      --line:rgba(255,255,255,.16);
      --text:#ffffff;
      --muted:rgba(255,255,255,.78);
      --accent:#2d8cff;
      --accent2:#57b3ff;
      --good:#27d6a6;
      --warn:#ffcc66;
      --bad:#ff5b7b;
      --r:16px;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% -10%, rgba(45,140,255,.35), transparent 60%),
                  radial-gradient(1200px 800px at 90% 10%, rgba(87,179,255,.25), transparent 65%),
                  linear-gradient(180deg, #041227, #061a33 60%, #041227);
      min-height:100vh;
    }
    .wrap{max-width:1100px;margin:22px auto;padding:0 14px}
    .topbar{
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:14px;
      display:flex;
      gap:14px;
      align-items:center;
      flex-wrap:wrap;
    }
    .brand{
      display:flex; align-items:center; gap:12px; min-width:260px;
    }
    .logo{
      width:44px;height:44px;border-radius:12px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--line);
      overflow:hidden; display:grid; place-items:center;
      flex:0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    .title b{font-size:16px;letter-spacing:.3px}
    .title .meta{font-size:12px;color:var(--muted);line-height:1.35;margin-top:2px}
    .actions{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--line);
      background:rgba(255,255,255,.08);
      color:var(--text);
      padding:10px 12px;border-radius:999px;
      cursor:pointer;
      font-weight:700;
      letter-spacing:.2px;
      transition:.15s transform, .15s background;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px);background:rgba(255,255,255,.12)}
    .btn.primary{background:linear-gradient(180deg,var(--accent),#1b6fe0);border-color:rgba(255,255,255,.22)}
    .btn.good{background:linear-gradient(180deg,var(--good),#1aa887);border-color:rgba(255,255,255,.20)}
    .btn.warn{background:linear-gradient(180deg,var(--warn),#f0a93a);border-color:rgba(255,255,255,.20);color:#10243f}
    .btn.bad{background:linear-gradient(180deg,var(--bad),#d93a60);border-color:rgba(255,255,255,.20)}
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
    }
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card h2{
      margin:0;
      padding:12px 14px;
      background:linear-gradient(180deg, rgba(45,140,255,.22), rgba(255,255,255,.02));
      border-bottom:1px solid var(--line);
      font-size:14px;
      letter-spacing:.3px;
    }
    .content{padding:14px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:560px){.row{grid-template-columns:1fr}}
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    input, select, textarea{
      width:100%;
      background:rgba(255,255,255,.10);
      color:var(--text);
      border:1px solid var(--line);
      border-radius:12px;
      padding:11px 12px;
      outline:none;
    }
    textarea{min-height:92px;resize:vertical}
    .hint{font-size:12px;color:var(--muted);margin-top:10px}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{
      border:1px solid var(--line);
      padding:9px 12px;
      border-radius:999px;
      cursor:pointer;
      background:rgba(255,255,255,.08);
      user-select:none;
      font-weight:700;
      font-size:12px;
    }
    .chip.on{background:linear-gradient(180deg, rgba(45,140,255,.45), rgba(27,111,224,.35)); border-color:rgba(255,255,255,.22)}
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(255,255,255,.06);
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      font-size:12px;
      color:var(--text);
      vertical-align:top;
    }
    th{color:rgba(255,255,255,.88);background:rgba(45,140,255,.18);text-align:left}
    tr:last-child td{border-bottom:none}
    .muted{color:var(--muted)}
    .foot{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap
    }
    .note-red{color:#ffd0d8;font-weight:800}
    .small{font-size:11px;color:rgba(255,255,255,.72)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" id="logoBox"><span class="small">MS</span></div>
        <div class="title">
          <b>MASCULINE SECURITY â€” Dienstplan</b>
          <div class="meta">
            Adresse: WerschenregerstraÃŸe 6, 28237 Bremen &nbsp;â€¢&nbsp; Tel: 015778697052<br/>
            E-Mail: Kontakt.mass.bremen@hotmail.com
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnReset">Reset</button>
        <button class="btn primary" id="btnAdd">Eintrag speichern</button>
        <button class="btn" id="btnPdf">PDF</button>
        <button class="btn good" id="btnWaPdf">WhatsApp (PDF)</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>WÃ¶chentlicher Mitarbeiter-Dienstplan</h2>
        <div class="content">
          <div class="row">
            <div>
              <label>Mitarbeiter Name</label>
              <input id="empName" placeholder="z.B. Mustafa Mursal Abdi" />
            </div>
            <div>
              <label>Mitarbeiter-Nr (optional)</label>
              <input id="empNr" placeholder="z.B. MS-001" />
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="row">
            <div>
              <label>Objekt / Einsatz</label>
              <input id="objekt" placeholder="z.B. Hotel / Baustelle / Asylheim" />
            </div>
            <div>
              <label>Logo (optional) â€” fÃ¼r PDF</label>
              <input type="file" id="logoFile" accept="image/*"/>
              <div class="small" style="margin-top:6px">Tipp: Logo wird gespeichert & im PDF angezeigt.</div>
            </div>
          </div>

          <div style="height:10px"></div>

          <label>Arbeitstage (klicken)</label>
          <div class="chips" id="dayChips"></div>

          <div style="height:10px"></div>

          <div class="row">
            <div>
              <label>Schicht (Tag/Nacht) â€” automatisch</label>
              <select id="shift" disabled>
                <option>Tag</option>
                <option>Nacht</option>
              </select>
              <div class="small" style="margin-top:6px">Wird automatisch gesetzt: Tag = 07:00â€“19:00, Nacht = 19:00â€“07:00</div>
            </div>
            <div>
              <label>Uhrzeit â€” automatisch</label>
              <input id="time" disabled />
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="row">
            <div>
              <label>Datum (fÃ¼r PDF)</label>
              <input id="pdfDate" />
              <div class="small" style="margin-top:6px">Format: TT.MM.JJJJ (z.B. 16.02.2026)</div>
            </div>
            <div>
              <label>Notiz â€” automatisch</label>
              <input id="note" placeholder="z.B. Rundgang / SchlÃ¼ssel" />
              <div class="small" style="margin-top:6px">Wenn leer: wird automatisch â€žRundgang / SchlÃ¼sselâ€œ gesetzt.</div>
            </div>
          </div>

          <div class="hint">
            <span class="note-red">Hinweis:</span> WhatsApp kann aus dem Browser **kein PDF automatisch anhÃ¤ngen** (Sicherheit).  
            Button Ã¶ffnet PDF-Print + Ã¶ffnet WhatsApp Chat mit Text â€” du fÃ¼gst die Datei dann kurz manuell hinzu.
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Vorschau + Gespeicherte EintrÃ¤ge</h2>
        <div class="content">
          <label>Vorschau (WhatsApp Text)</label>
          <textarea id="preview" readonly></textarea>

          <div style="height:12px"></div>

          <table>
            <thead>
              <tr>
                <th>Mitarbeiter</th>
                <th>Tage</th>
                <th>Objekt</th>
                <th>Schicht</th>
                <th>Uhrzeit</th>
                <th>Notiz</th>
                <th>Aktion</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <tr><td colspan="7" class="muted">Noch keine EintrÃ¤ge.</td></tr>
            </tbody>
          </table>

          <div class="foot">
            <div>Auto-Save: <b id="autosave">AN</b></div>
            <div>Version: <b>vFinal</b></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* =========================
   STATE + STORAGE
========================= */
const STORE_KEY = "ms_dienstplan_final";
const state = {
  meta: {
    company: "Masculine Security",
    address: "WerschenregerstraÃŸe 6, 28237 Bremen",
    phone: "015778697052",
    email: "Kontakt.mass.bremen@hotmail.com",
    logoDataUrl: ""
  },
  entries: []
};

function save(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }
function load(){
  const raw = localStorage.getItem(STORE_KEY);
  if(!raw) return;
  try{
    const obj = JSON.parse(raw);
    if(obj && typeof obj==="object"){
      Object.assign(state.meta, obj.meta||{});
      state.entries = Array.isArray(obj.entries) ? obj.entries : [];
    }
  }catch(e){}
}

/* =========================
   HELPERS
========================= */
const DAYS = [
  {k:"Mo", l:"Montag"},
  {k:"Di", l:"Dienstag"},
  {k:"Mi", l:"Mittwoch"},
  {k:"Do", l:"Donnerstag"},
  {k:"Fr", l:"Freitag"},
  {k:"Sa", l:"Samstag"},
  {k:"So", l:"Sonntag"},
];

function todayDE(){
  // default your requested format (can be edited)
  return "16.02.2026";
}
function normalize(s){ return String(s||"").trim(); }

const SHIFT_TIMES = {
  Tag: "07:00â€“19:00",
  Nacht: "19:00â€“07:00"
};

function autoShiftByObjekt(obj){
  const t = normalize(obj).toLowerCase();
  // simple keyword rules (you can extend)
  if(/nacht|night|hotel|asyl|heim|rundgang/.test(t)) return "Nacht";
  return "Tag";
}

function autoNoteIfEmpty(note){
  const n = normalize(note);
  return n ? n : "Rundgang / SchlÃ¼ssel";
}

function buildWhatsAppText(entry){
  const date = normalize(document.getElementById("pdfDate").value) || todayDE();
  return (
`Dienstplan â€“ ${date}

Mitarbeiter: ${entry.empName}${entry.empNr ? " ("+entry.empNr+")" : ""}
Tage: ${entry.days.join(", ")}
Schicht: ${entry.shift}
Uhrzeit: ${entry.time}
Objekt: ${entry.objekt}
Notiz: ${entry.note}

Masculine Security
Tel: ${state.meta.phone}
E-Mail: ${state.meta.email}`
  );
}

/* =========================
   UI INIT
========================= */
const $ = (id)=>document.getElementById(id);

function renderLogo(){
  const box = $("logoBox");
  box.innerHTML = "";
  if(state.meta.logoDataUrl){
    const img = document.createElement("img");
    img.src = state.meta.logoDataUrl;
    box.appendChild(img);
  }else{
    box.innerHTML = '<span class="small">MS</span>';
  }
}

function renderDaysChips(selected=new Set()){
  const wrap = $("dayChips");
  wrap.innerHTML = "";
  DAYS.forEach(d=>{
    const b = document.createElement("div");
    b.className = "chip"+(selected.has(d.k)?" on":"");
    b.textContent = d.k+" â€” "+d.l;
    b.dataset.day = d.k;
    b.addEventListener("click", ()=>{
      if(selected.has(d.k)) selected.delete(d.k); else selected.add(d.k);
      renderDaysChips(selected);
      updatePreviewFromForm(selected);
    });
    wrap.appendChild(b);
  });
  return selected;
}

let selectedDays = renderDaysChips(new Set(["Mo","Di","Mi","Do"]));

function updateShiftAndTime(){
  const obj = $("objekt").value;
  const shift = autoShiftByObjekt(obj);
  $("shift").value = shift;
  $("time").value = SHIFT_TIMES[shift];
}

function updatePreviewFromForm(daysSet){
  const empName = normalize($("empName").value) || "Mitarbeiter";
  const empNr   = normalize($("empNr").value);
  const objekt  = normalize($("objekt").value) || "Objekt";
  updateShiftAndTime();
  const shift = $("shift").value;
  const time  = $("time").value;
  const note  = autoNoteIfEmpty($("note").value);

  const entry = {
    empName, empNr, objekt,
    days: Array.from(daysSet),
    shift, time,
    note
  };
  $("preview").value = buildWhatsAppText(entry);
}

function renderTable(){
  const body = $("tbody");
  if(!state.entries.length){
    body.innerHTML = '<tr><td colspan="7" class="muted">Noch keine EintrÃ¤ge.</td></tr>';
    return;
  }
  body.innerHTML = "";
  state.entries.forEach((e, idx)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${escapeHtml(e.empName)} ${e.empNr?'<span class="muted">('+escapeHtml(e.empNr)+')</span>':""}</td>
      <td>${escapeHtml(e.days.join(", "))}</td>
      <td>${escapeHtml(e.objekt)}</td>
      <td>${escapeHtml(e.shift)}</td>
      <td>${escapeHtml(e.time)}</td>
      <td>${escapeHtml(e.note)}</td>
      <td>
        <button class="btn" data-act="copy" data-i="${idx}">Text</button>
        <button class="btn bad" data-act="del" data-i="${idx}">Delete</button>
      </td>
    `;
    body.appendChild(tr);
  });

  body.querySelectorAll("button").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const i = Number(btn.dataset.i);
      const act = btn.dataset.act;
      if(act==="del"){
        state.entries.splice(i,1);
        save(); renderTable(); updatePreviewFromForm(selectedDays);
      }
      if(act==="copy"){
        const text = buildWhatsAppText(state.entries[i]);
        navigator.clipboard?.writeText(text).catch(()=>{});
        $("preview").value = text;
        alert("Text in Vorschau (und Clipboard wenn erlaubt).");
      }
    });
  });
}

function escapeHtml(s){
  return String(s||"")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* =========================
   PDF WINDOW (PRINT)
========================= */
function buildPdfHtml(){
  const date = normalize($("pdfDate").value) || todayDE();
  const empName = normalize($("empName").value) || "Mitarbeiter";
  const empNr   = normalize($("empNr").value);
  const objekt  = normalize($("objekt").value) || "Objekt";
  updateShiftAndTime();
  const shift = $("shift").value;
  const time  = $("time").value;
  const note  = autoNoteIfEmpty($("note").value);
  const days  = Array.from(selectedDays);

  const logo = state.meta.logoDataUrl ? `<img src="${state.meta.logoDataUrl}" style="width:46px;height:46px;border-radius:10px;object-fit:cover">`
                                     : `<div style="width:46px;height:46px;border-radius:10px;background:#0b2a55;color:#fff;display:grid;place-items:center;font-weight:800">MS</div>`;

  // A4-ish clean like your example, but BLUE
  const rows = DAYS.map(d=>{
    const on = days.includes(d.k);
    return `
      <tr>
        <td style="width:80px">${d.k}</td>
        <td style="width:140px">${on ? (shift==="Nacht" ? "19:00â€“07:00" : "07:00â€“19:00") : "â€”"}</td>
        <td>${on ? escapeHtml(objekt) : "â€”"}</td>
        <td>${on ? escapeHtml(note) : "â€”"}</td>
      </tr>
    `;
  }).join("");

  return `
<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Dienstplan</title>
<style>
  @page{ size:A4; margin:14mm; }
  body{ font-family: Arial, sans-serif; color:#0b1a33; }
  .box{ border:1px solid #d7e6ff; border-radius:14px; padding:12px; }
  .head{ display:flex; gap:12px; align-items:center; }
  .meta{ font-size:12px; line-height:1.35; }
  .date{ margin-left:auto; font-size:12px; }
  .line{ height:3px; background:#2d8cff; margin:10px 0; }
  h1{ margin:6px 0 8px; text-align:center; font-size:18px; color:#0a2d57; }
  table{ width:100%; border-collapse:collapse; font-size:12px; }
  th, td{ border:1px solid #e6eefc; padding:8px; }
  th{ background:#eef6ff; text-align:left; color:#0a2d57; }
  .warn{ margin-top:10px; text-align:center; font-size:11px; color:#8a1a2b; }
  .foot{ display:flex; justify-content:space-between; margin-top:10px; font-size:11px; color:#5c6b86; }
</style>
</head>
<body>
  <div class="box">
    <div class="head">
      ${logo}
      <div class="meta">
        <b style="font-size:16px;color:#0a2d57">Masculine Security</b><br>
        Adresse: ${escapeHtml(state.meta.address)}<br>
        Tel: ${escapeHtml(state.meta.phone)}<br>
        E-Mail: ${escapeHtml(state.meta.email)}
      </div>
      <div class="date"><b>Datum:</b> ${escapeHtml(date)}</div>
    </div>

    <div class="line"></div>

    <h1>VorlÃ¤ufiger Dienstplan</h1>

    <div style="font-size:12px;margin-bottom:8px">
      <b>Mitarbeiter:</b> ${escapeHtml(empName)} ${empNr ? "("+escapeHtml(empNr)+")" : ""}<br>
      <b>Schicht:</b> ${escapeHtml(shift)} &nbsp;â€¢&nbsp; <b>Uhrzeit:</b> ${escapeHtml(time)}
    </div>

    <table>
      <thead>
        <tr>
          <th style="width:80px">TAG</th>
          <th style="width:140px">UHRZEIT</th>
          <th>OBJEKT</th>
          <th style="width:220px">NOTIZ</th>
        </tr>
      </thead>
      <tbody>
        ${rows}
      </tbody>
    </table>

    <div class="warn">
      <b>DRINGEND BEACHTEN:</b><br>
      Dienstantritt ist 20 Minuten vor Dienstbeginn!<br>
      VerspÃ¤tungen und AusfÃ¤lle sind unverzÃ¼glich telefonisch zu melden!
    </div>

    <div class="foot">
      <div>Masculine Security â€” Dienstplan</div>
      <div>Seite 1 von 1</div>
    </div>
  </div>

<script>
  // auto open print dialog
  setTimeout(()=>{ window.print(); }, 300);
</script>
</body>
</html>
`;
}

function openPdfPrintWindow(){
  const w = window.open("", "_blank", "noopener,noreferrer");
  if(!w){ alert("Popup blockiert. Bitte Popups erlauben und nochmal klicken."); return null; }
  w.document.open();
  w.document.write(buildPdfHtml());
  w.document.close();
  return w;
}

/* =========================
   WHATSAPP (PDF) FLOW
========================= */
function openWhatsAppWithText(text){
  const url = "https://wa.me/?text=" + encodeURIComponent(text);
  window.open(url, "_blank", "noopener,noreferrer");
}

function sendWhatsAppPdfFlow(){
  // 1) Open PDF print window (user chooses Save as PDF)
  openPdfPrintWindow();

  // 2) Open WhatsApp with ready text (PDF attach manually)
  const empName = normalize($("empName").value) || "Mitarbeiter";
  const note = autoNoteIfEmpty($("note").value);
  const date = normalize($("pdfDate").value) || todayDE();
  const msg =
`PDF ist bereit âœ”ï¸ (bitte im Print-Dialog "Save as PDF" wÃ¤hlen)
Datum: ${date}
Mitarbeiter: ${empName}
Notiz: ${note}

ðŸ‘‰ Danach PDF in WhatsApp als Datei anhÃ¤ngen und senden.`;
  setTimeout(()=>openWhatsAppWithText(msg), 700);
}

/* =========================
   ADD ENTRY
========================= */
function addEntry(){
  const empName = normalize($("empName").value);
  if(!empName){ alert("Bitte Mitarbeiter Name eingeben."); return; }

  const empNr  = normalize($("empNr").value);
  const objekt = normalize($("objekt").value) || "Objekt";
  updateShiftAndTime();
  const shift = $("shift").value;
  const time  = $("time").value;
  const note  = autoNoteIfEmpty($("note").value);
  const days  = Array.from(selectedDays);

  const entry = { empName, empNr, objekt, days, shift, time, note };
  state.entries.push(entry);
  save();
  renderTable();
  $("preview").value = buildWhatsAppText(entry);
  alert("Gespeichert âœ…");
}

/* =========================
   RESET
========================= */
function resetAll(){
  if(!confirm("Reset? Alle gespeicherten Daten werden gelÃ¶scht.")) return;
  localStorage.removeItem(STORE_KEY);
  location.reload();
}

/* =========================
   EVENTS
========================= */
$("pdfDate").value = todayDE();

["empName","empNr","objekt","note","pdfDate"].forEach(id=>{
  $(id).addEventListener("input", ()=>{
    updateShiftAndTime();
    updatePreviewFromForm(selectedDays);
    save(); // autosave meta/inputs not stored separately, but ok to keep state stable
  });
});

$("btnAdd").addEventListener("click", addEntry);
$("btnReset").addEventListener("click", resetAll);
$("btnPdf").addEventListener("click", openPdfPrintWindow);
$("btnWaPdf").addEventListener("click", sendWhatsAppPdfFlow);

$("logoFile").addEventListener("change", (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    state.meta.logoDataUrl = String(reader.result||"");
    renderLogo();
    save();
    alert("Logo gespeichert âœ… (wird im PDF angezeigt)");
  };
  reader.readAsDataURL(f);
});

/* =========================
   BOOT
========================= */
load();
renderLogo();
renderTable();
updateShiftAndTime();
updatePreviewFromForm(selectedDays);

</script>
</body>
</html>

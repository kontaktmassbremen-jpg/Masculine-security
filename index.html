<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Masculine Security — Dienstplan</title>
  <meta name="theme-color" content="#0b1220"/>
  <link rel="manifest" href="manifest.json"/>

  <style>
    :root{
      --bg:#071225; --panel:#0b1a33; --card:#0f2a4f; --line:#16345e;
      --text:#e7f0ff; --muted:#9bb1d5; --accent:#3aa6ff;
      --good:#21d19f; --warn:#ffce54; --bad:#ff4d6d;
      --r:16px; --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--font); color:var(--text);
      background:
        radial-gradient(1200px 700px at 30% -10%, rgba(58,166,255,.20), transparent 55%),
        radial-gradient(900px 600px at 90% 10%, rgba(33,209,159,.12), transparent 55%),
        var(--bg);
      overflow-x:hidden;
    }
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      background: rgba(11,26,51,.92);
      border:1px solid var(--line); border-radius:var(--r);
      padding:12px;
      box-shadow:0 10px 28px rgba(0,0,0,.35);
    }
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:52px;height:52px;border-radius:14px;object-fit:cover;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12)}
    .brand h1{margin:0;font-size:15px;letter-spacing:.4px}
    .meta{font-size:12px;color:var(--muted);line-height:1.35}
    .meta a{color:var(--text);text-decoration:none;border-bottom:1px dashed rgba(231,240,255,.35)}
    .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .btn{
      background: rgba(58,166,255,.14);
      border:1px solid rgba(58,166,255,.32);
      color:var(--text);
      padding:9px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:700;
      font-size:12px;
    }
    .btn.secondary{background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.14)}
    .btn.good{background: rgba(33,209,159,.14); border:1px solid rgba(33,209,159,.32)}
    .btn.warn{background: rgba(255,206,84,.14); border:1px solid rgba(255,206,84,.28)}
    .btn.bad{background: rgba(255,77,109,.14); border:1px solid rgba(255,77,109,.28)}

    .card{
      margin-top:14px;
      background: rgba(15,42,79,.80);
      border:1px solid var(--line);
      border-radius:var(--r);
      padding:14px;
      box-shadow:0 10px 28px rgba(0,0,0,.25);
    }
    h2{margin:0 0 10px 0;font-size:14px}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-size:12px}
    input, select{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(7,18,37,.55);
      color:var(--text);
      outline:none;
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width: 820px){ .row{grid-template-columns:1fr} }

    table{
      width:100%;
      border-collapse:collapse;
      border:1px solid rgba(255,255,255,.12);
      border-radius:12px;
      overflow:hidden;
      margin-top:12px;
    }
    th, td{padding:10px;border-bottom:1px solid rgba(255,255,255,.10);font-size:12px;vertical-align:top}
    th{background: rgba(7,18,37,.50);color:var(--muted);text-align:left}
    tr:last-child td{border-bottom:none}
    .sbtn{
      padding:8px 10px;border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);cursor:pointer;font-weight:700;font-size:12px;
    }
    .toast{
      margin-top:10px;padding:10px 12px;border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(7,18,37,.45);
      color:var(--muted);font-size:12px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <img id="logoImg" class="logo" src="logo.png" alt="Logo" onerror="this.style.opacity=.25;">
        <div>
          <h1 id="titleTop">Masculine Security — Dienstplan</h1>
          <div class="meta">
            Adresse: <span id="cAddrTxt">Werschenregerstraße 6 · 28237 Bremen</span><br>
            Tel: <a id="cTelLink" href="tel:015778697052">015778697052</a> ·
            E-Mail: <a id="cEmailLink" href="mailto:kontakt.mass.bremen@hotmail.com">kontakt.mass.bremen@hotmail.com</a>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn secondary" id="btnPDF" type="button">PDF (Proc-Style)</button>
        <button class="btn good" id="btnWA" type="button">WhatsApp (Text)</button>
        <button class="btn warn" id="btnCSV" type="button">Export CSV</button>
        <button class="btn bad" id="btnReset" type="button">Reset</button>
      </div>
    </div>

    <div class="card">
      <h2>Dienstplan Eingabe</h2>

      <div class="row">
        <div>
          <label>KW</label>
          <input id="kw" type="number" min="1" max="53" value="32">
        </div>
        <div>
          <label>Start-Datum (Montag)</label>
          <input id="weekStart" type="date">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Mitarbeiter Name</label>
          <input id="empName" placeholder="z.B. Mustafa Mursal Abdi">
        </div>
        <div>
          <label>Mitarbeiter-Nr (optional)</label>
          <input id="empNo" placeholder="z.B. MS-001">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Tag</label>
          <select id="day">
            <option value="Mo">Montag</option><option value="Di">Dienstag</option><option value="Mi">Mittwoch</option>
            <option value="Do">Donnerstag</option><option value="Fr">Freitag</option><option value="Sa">Samstag</option>
            <option value="So">Sonntag</option>
          </select>
        </div>
        <div>
          <label>Objekt / Einsatz</label>
          <input id="objekt" placeholder="z.B. LAST Birkenfels">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Uhrzeit</label>
          <input id="time" placeholder="z.B. 19:00–07:00">
        </div>
        <div>
          <label>Notiz (optional)</label>
          <input id="note" placeholder="z.B. Tor 2 / Schlüssel / Uniform">
        </div>
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="sbtn" id="btnAdd" type="button">+ Eintrag speichern</button>
      </div>

      <table>
        <thead>
          <tr><th>Mitarbeiter</th><th>Tag</th><th>Objekt</th><th>Uhrzeit</th><th>Notiz</th><th>Aktion</th></tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="6" style="color:#556b92">Noch keine Einträge.</td></tr>
        </tbody>
      </table>

      <div id="toast" class="toast">Bereit (v7)</div>
    </div>
  </div>

  <script>
    "use strict";
    const K_ENT="MS_ENT_V7";

    const $=id=>document.getElementById(id);
    const pad2=n=>String(n).padStart(2,"0");

    const order={Mo:1,Di:2,Mi:3,Do:4,Fr:5,Sa:6,So:7};
    const dayLabel=k=>({Mo:"Montag",Di:"Dienstag",Mi:"Mittwoch",Do:"Donnerstag",Fr:"Freitag",Sa:"Samstag",So:"Sonntag"}[k]||k);

    const state={ entries: [] };

    function setToast(t){ $("toast").textContent=t; }

    function save(){ localStorage.setItem(K_ENT, JSON.stringify(state.entries)); }
    function load(){
      try{ state.entries=JSON.parse(localStorage.getItem(K_ENT)||"[]")||[]; }catch(_){ state.entries=[]; }
    }

    function esc(s){
      return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
    }

    function render(){
      const tb=$("tbody");
      if(!state.entries.length){
        tb.innerHTML=`<tr><td colspan="6" style="color:#556b92">Noch keine Einträge.</td></tr>`;
        return;
      }
      tb.innerHTML=state.entries.map((e,i)=>`
        <tr>
          <td><b>${esc(e.empName)}</b><div style="font-size:11px;color:#9bb1d5">${esc(e.empNo||"")}</div></td>
          <td>${dayLabel(e.day)}</td>
          <td>${esc(e.objekt)}</td>
          <td>${esc(e.time)}</td>
          <td>${esc(e.note||"")}</td>
          <td><button class="sbtn" data-del="${i}">Löschen</button></td>
        </tr>
      `).join("");

      tb.querySelectorAll("button[data-del]").forEach(b=>{
        b.onclick=()=>{
          const i=Number(b.getAttribute("data-del"));
          state.entries.splice(i,1);
          save(); render(); setToast("Gelöscht ✅");
        };
      });
    }

    function add(){
      const empName=($("empName").value||"").trim();
      const empNo=($("empNo").value||"").trim();
      const day=$("day").value;
      const objekt=($("objekt").value||"").trim();
      const time=($("time").value||"").trim();
      const note=($("note").value||"").trim();
      if(!empName||!objekt||!time){ setToast("Fadlan Name/Objekt/Uhrzeit buuxi."); return; }
      state.entries.push({empName, empNo, day, objekt, time, note});
      state.entries.sort((a,b)=>(order[a.day]-order[b.day]) || a.empName.localeCompare(b.empName));
      save(); render(); setToast("Gespeichert ✅");
    }

    function mondayOfThisWeek(){
      const d=new Date(); const day=d.getDay(); const diff=(day===0?-6:1-day);
      const mon=new Date(d.getFullYear(), d.getMonth(), d.getDate()+diff);
      return `${mon.getFullYear()}-${pad2(mon.getMonth()+1)}-${pad2(mon.getDate())}`;
    }

    function waText(){
      const kw=$("kw").value||"";
      const ws=$("weekStart").value||"";
      const lines=[];
      lines.push(`Masculine Security — Dienstplan KW ${kw}`);
      lines.push(`Start (Mo): ${ws}`);
      lines.push(`Tel: 015778697052 | Email: kontakt.mass.bremen@hotmail.com`);
      lines.push(`---------------------------`);
      state.entries.forEach(e=>{
        lines.push(`${dayLabel(e.day)} — ${e.empName}${e.empNo?` (${e.empNo})`:""} — ${e.objekt} — ${e.time}${e.note?` — ${e.note}`:""}`);
      });
      return lines.join("\n");
    }

    function sendWA(){
      const url="https://wa.me/?text="+encodeURIComponent(waText());
      window.open(url,"_blank","noopener,noreferrer");
      setToast("WhatsApp text geöffnet ✅");
    }

    function exportCSV(){
      const header=["Mitarbeiter","Nr","Tag","Objekt","Uhrzeit","Notiz"].join(";");
      const rows=state.entries.map(e=>[e.empName,e.empNo||"",dayLabel(e.day),e.objekt,e.time,e.note||""].join(";"));
      const blob=new Blob([header+"\n"+rows.join("\n")],{type:"text/csv;charset=utf-8"});
      const a=document.createElement("a");
      a.href=URL.createObjectURL(blob);
      a.download="dienstplan.csv";
      document.body.appendChild(a); a.click(); a.remove();
      setToast("CSV exportiert ✅");
    }

    function resetAll(){
      if(!confirm("Reset ALL data?")) return;
      localStorage.removeItem(K_ENT);
      location.reload();
    }

    // PDF Proc-style => open print window (Save as PDF)
    function openPDF(){
      alert("PDF: Browser print dialog ayaa furmaya. Dooro 'Save as PDF'. (WhatsApp direct file send browser-ka si toos ah uma oggola.)");
      window.print();
    }

    // init
    $("weekStart").value = mondayOfThisWeek();
    load(); render();
    $("btnAdd").onclick=add;
    $("btnWA").onclick=sendWA;
    $("btnCSV").onclick=exportCSV;
    $("btnReset").onclick=resetAll;
    $("btnPDF").onclick=openPDF;

    // register SW
    window.addEventListener("load", ()=>{
      if("serviceWorker" in navigator){
        navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
      }
    });
  </script>
</body>
</html>

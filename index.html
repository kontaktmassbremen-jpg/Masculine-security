<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Masculine Security ‚Äî Office + Rechnung + Payroll</title>

<style>
:root{
  --bg:#0b1220;--panel:#111c33;--card:#15264a;--accent:#3aa6ff;
  --text:#eee;--muted:#9fb2ff;--danger:#c44;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:var(--bg);color:var(--text)}
.app{display:grid;grid-template-columns:260px 1fr;height:100vh}
.sidebar{background:var(--panel);padding:14px}
.sidebar button{
  width:100%;margin-bottom:8px;padding:10px;border-radius:8px;
  border:none;background:#1c2f55;color:#fff;cursor:pointer;font-weight:700
}
.sidebar button.active{background:var(--accent)}
.main{padding:18px;overflow:auto}
.card{background:var(--card);border-radius:10px;padding:14px;margin-bottom:14px}
h2,h3{margin:0 0 10px}
input,select,textarea{
  width:100%;padding:8px;border-radius:6px;
  border:1px solid #333;background:#081427;color:#fff
}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #333;padding:6px}
.right{text-align:right}
.btn{padding:8px 12px;border:none;border-radius:8px;background:var(--accent);color:#fff;cursor:pointer}
.btn.danger{background:var(--danger)}
hr{border:0;border-top:1px solid #333;margin:12px 0}
.note{font-size:12px;color:#ddd}
</style>
</head>

<body>

<div class="app">

<!-- ================= SIDEBAR ================= -->
<div class="sidebar">
  <button data-p="invoice" class="active">üßæ Rechnung</button>
  <button data-p="employees">üë§ Mitarbeiter</button>
  <button data-p="payroll">üí∂ Payroll / SV</button>
  <button data-p="settings">‚öôÔ∏è Firma</button>
</div>

<!-- ================= MAIN ================= -->
<div class="main">

<!-- ============== RECHNUNG ============== -->
<section id="p-invoice">
<div class="card">
<h2>Rechnung Rechner</h2>

<label>Tage</label><input id="i_days" type="number">
<label>Std / Tag</label><input id="i_hpd" type="number">
<label>‚Ç¨/h</label><input id="i_rate" type="number">

<label>Total Stunden</label><input id="i_totalh" readonly>
<label>Gesamt ‚Ç¨</label><input id="i_total" readonly>

<button class="btn" id="btnCalcInv">Berechnen</button>
<button class="btn" id="btnPDFInv">PDF</button>

<p class="note">Auto: Tage √ó Std/Tag √ó ‚Ç¨/h</p>
</div>
</section>

<!-- ============== MITARBEITER ============== -->
<section id="p-employees" hidden>
<div class="card">
<h2>Mitarbeiter</h2>

<input id="e_name" placeholder="Name">
<input id="e_rate" placeholder="‚Ç¨/h">
<label><input type="checkbox" id="e_sv"> Sozialversicherungspflichtig</label>

<button class="btn" id="btnSaveEmp">Speichern</button>

<table class="table">
<thead><tr><th>Name</th><th>‚Ç¨/h</th><th>SV</th><th></th></tr></thead>
<tbody id="empList"></tbody>
</table>
</div>
</section>

<!-- ============== PAYROLL ============== -->
<section id="p-payroll" hidden>
<div class="card">
<h2>Payroll / Sozialversicherung</h2>

<select id="p_emp"></select>
<label>Stunden</label><input id="p_hours" type="number">

<button class="btn" id="btnCalcPay">Berechnen</button>

<div id="payResult"></div>

<hr>

<button class="btn" id="btnPDFLohn">üìÑ Lohnabrechnung</button>
<button class="btn" id="btnPDFArbeits">üìÑ Arbeitsbescheinigung</button>
<button class="btn" id="btnPDFSteuer">üìÑ Steuer√ºbersicht</button>

<p class="note">Hinweis: Nur interne Berechnung ‚Äì kein offizielles Dokument.</p>
</div>
</section>

<!-- ============== SETTINGS ============== -->
<section id="p-settings" hidden>
<div class="card">
<h2>Firma</h2>
<input id="s_name" placeholder="Firma">
<textarea id="s_addr" placeholder="Adresse"></textarea>
<button class="btn" id="btnSaveSettings">Speichern</button>
</div>
</section>

</div>
</div>

<script>
/* ================= STORAGE ================= */
const DB="ms_complete_v30";
let DATA=JSON.parse(localStorage.getItem(DB)||"{}");
DATA.emps ||= [];
DATA.settings ||= {name:"Masculine Security",addr:"Bremen"};

function save(){localStorage.setItem(DB,JSON.stringify(DATA));}

/* ================= NAV ================= */
document.querySelectorAll(".sidebar button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".sidebar button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    document.querySelectorAll("section").forEach(s=>s.hidden=true);
    document.getElementById("p-"+b.dataset.p).hidden=false;
  };
});

/* ================= EMPLOYEES ================= */
function renderEmp(){
  let t=empList;
  let sel=p_emp;
  t.innerHTML=""; sel.innerHTML="";
  DATA.emps.forEach(e=>{
    let tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${e.name}</td>
      <td>${e.rate}</td>
      <td>${e.sv?"ja":"nein"}</td>
      <td><button data-id="${e.id}" class="btn danger">X</button></td>`;
    t.appendChild(tr);

    let o=document.createElement("option");
    o.value=e.id;o.textContent=e.name;
    sel.appendChild(o);
  });

  t.querySelectorAll("button").forEach(b=>{
    b.onclick=()=>{
      DATA.emps=DATA.emps.filter(e=>e.id!=b.dataset.id);
      save();renderEmp();
    };
  });
}

btnSaveEmp.onclick=()=>{
  if(!e_name.value)return alert("Name fehlt");
  let e={
    id:Date.now(),
    name:e_name.value,
    rate:+e_rate.value||0,
    sv:e_sv.checked
  };
  DATA.emps.push(e);save();renderEmp();
  e_name.value="";e_rate.value="";e_sv.checked=false;
};

/* ================= INVOICE ================= */
btnCalcInv.onclick=()=>{
  let h=(+i_days.value||0)*(+i_hpd.value||0);
  i_totalh.value=h.toFixed(2);
  i_total.value=(h*(+i_rate.value||0)).toFixed(2);
};

btnPDFInv.onclick=()=>{
  let w=window.open("");
  w.document.write(`
    <h1>Rechnung</h1>
    <b>${DATA.settings.name}</b><br>
    ${DATA.settings.addr}<hr>
    Stunden: ${i_totalh.value}<br>
    Gesamt: ${i_total.value} ‚Ç¨<br>
  `);
  w.print();
};

/* ================= PAYROLL ================= */
const SV_AN=0.203;
const SV_AG=0.203;

btnCalcPay.onclick=()=>{
  let e=DATA.emps.find(x=>x.id==p_emp.value);
  if(!e)return alert("Mitarbeiter w√§hlen");

  let brutto=(+p_hours.value||0)*e.rate;
  let an=e.sv?brutto*SV_AN:0;
  let ag=e.sv?brutto*SV_AG:0;

  payResult.innerHTML=`
    <p>Brutto: ${brutto.toFixed(2)} ‚Ç¨</p>
    <p>AN-SV: ${an.toFixed(2)} ‚Ç¨</p>
    <p><b>Netto (estimate): ${(brutto-an).toFixed(2)} ‚Ç¨</b></p>
    <p>AG-SV: ${ag.toFixed(2)} ‚Ç¨</p>
    <p><b>Gesamtkosten Firma: ${(brutto+ag).toFixed(2)} ‚Ç¨</b></p>
  `;
};

function payrollPDF(title){
  let e=DATA.emps.find(x=>x.id==p_emp.value);
  if(!e)return;
  let brutto=(+p_hours.value||0)*e.rate;
  let w=window.open("");
  w.document.write(`
    <h1>${title}</h1>
    <b>${DATA.settings.name}</b><hr>
    Mitarbeiter: ${e.name}<br>
    Stunden: ${p_hours.value}<br>
    Brutto: ${brutto.toFixed(2)} ‚Ç¨<br>
    <small>Nur interne Berechnung</small>
  `);
  w.print();
}

btnPDFLohn.onclick=()=>payrollPDF("Lohnabrechnung (intern)");
btnPDFArbeits.onclick=()=>payrollPDF("Arbeitsbescheinigung");
btnPDFSteuer.onclick=()=>payrollPDF("Steuer√ºbersicht");

/* ================= SETTINGS ================= */
btnSaveSettings.onclick=()=>{
  DATA.settings.name=s_name.value||DATA.settings.name;
  DATA.settings.addr=s_addr.value||DATA.settings.addr;
  save();
  alert("Gespeichert");
};

/* INIT */
renderEmp();
s_name.value=DATA.settings.name;
s_addr.value=DATA.settings.addr;
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Masculine Security — Office</title>

<link rel="manifest" href="manifest.json" />

<meta name="theme-color" content="#0b1220" />

<style>
:root{
  --bg:#0b1220;
  --panel:#0f1a2f;
  --card:#10203a;
  --text:#e7eeff;
  --accent:#3aa6ff;
  --r:16px;
  font-family: system-ui, Arial;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
}
header{
  padding:20px;
  background:var(--panel);
  font-size:22px;
  font-weight:700;
}
main{
  padding:20px;
}
.card{
  background:var(--card);
  border-radius:var(--r);
  padding:20px;
  margin-bottom:20px;
}
button{
  background:var(--accent);
  border:none;
  padding:12px 20px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}
small{opacity:.6}
</style>
</head>

<body>

<header>Masculine Security — Mini Office</header>

<main>

<div class="card">
<h2>Invoice Generator</h2>
<p>Dieses System aktualisiert sich automatisch nach GitHub Push.</p>
<button onclick="location.reload()">Reload manually</button>
<p><small id="ver">loading version…</small></p>
</div>

</main>

<!-- ================= AUTO UPDATE SYSTEM ================= -->

<script>
(async () => {

  /* ---------- SERVICE WORKER REGISTER ---------- */
  if ("serviceWorker" in navigator) {
    const reg = await navigator.serviceWorker.register("./service-worker.js");

    reg.addEventListener("updatefound", () => {
      const nw = reg.installing;
      if (!nw) return;

      nw.addEventListener("statechange", () => {
        if (nw.state === "installed" && navigator.serviceWorker.controller) {
          console.log("New version detected → reload");
          location.reload();
        }
      });
    });
  }

  /* ---------- VERSION CHECK ---------- */
  async function getVersion(){
    const r = await fetch("./version.txt", { cache:"no-store" });
    return r.text();
  }

  let v = await getVersion();
  document.getElementById("ver").innerText = "Version: " + v;

  setInterval(async () => {
    const nv = await getVersion();
    if (nv !== v){
      console.log("Version changed → reload");
      location.reload();
    }
  }, 25000); // every 25s

})();
</script>

</body>
</html>

<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Masculine Security – Rechnung</title>

  <style>
    :root{ --bg:#0b1220; --panel:#10203a; --line:#cfcfcf; --text:#e7eeff; --muted:#93a4c6; --accent:#3aa6ff; }
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:1100px;margin:0 auto;padding:18px;}
    h1{margin:8px 0 14px;font-size:28px;font-weight:800}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px}
    .card h3{margin:0 0 10px;font-size:16px}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,.25);outline:none}
    textarea{min-height:72px;resize:vertical}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    button{border:0;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer}
    .primary{background:var(--accent);color:#001a2b}
    .ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.18)}
    .mini{font-size:12px;color:var(--muted);margin-top:10px}
    .kpi{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .pill{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);padding:8px 10px;border-radius:999px;font-size:12px;color:var(--text)}

    /* ===== PRINT ===== */
    @media print{
      body{background:#fff;color:#000}
      .wrap{max-width:none;padding:0}
      .no-print{display:none !important}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="no-print">
      <h1>Masculine Security – Rechnung Generator</h1>

      <div class="grid">
        <div class="card">
          <h3>Firma</h3>
          <label>Firmenname</label><input id="s_company" placeholder="Masculine Security">
          <label>Adresse</label><textarea id="s_addr" placeholder="Werschenregerstraße 6&#10;28237 Bremen"></textarea>
          <div class="row">
            <div class="col">
              <label>E-Mail (Firma)</label><input id="s_email" placeholder="kontakt.mass.bremen@hotmail.com">
            </div>
            <div class="col">
              <label>Steuernummer</label><input id="s_taxid" placeholder="...">
            </div>
          </div>
          <div class="row">
            <div class="col"><label>IBAN</label><input id="s_iban" placeholder="DE98 1001 1001 2333 0146 96"></div>
            <div class="col"><label>BIC</label><input id="s_bic" placeholder="NTSBDEB1XXX"></div>
          </div>
          <label>§19 Hinweis</label><textarea id="s_hint" placeholder="Gemäß § 19 UStG wird keine Umsatzsteuer berechnet."></textarea>
          <div class="btns">
            <button class="ghost" onclick="saveAll()">Speichern</button>
            <button class="ghost" onclick="loadAll()">Laden</button>
            <button class="ghost" onclick="resetAll()">Reset</button>
          </div>
        </div>

        <div class="card">
          <h3>Kunde</h3>
          <label>Name</label><input id="c_name" placeholder="Mustafa Mursal">
          <label>Adresse</label><textarea id="c_addr" placeholder="Werschenregerstr 6&#10;28237 Bremen"></textarea>
          <label>E-Mail (Kunde)</label><input id="c_email" placeholder="mursal.abdi000@gmail.com">
        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <h3>Rechnung</h3>

        <div class="row">
          <div class="col">
            <label>Rechnungs-Nr.</label><input id="i_no" placeholder="MS-2026-0001">
          </div>
          <div class="col">
            <label>Datum</label><input id="i_date" type="date">
          </div>
          <div class="col">
            <label>Status</label>
            <select id="i_status">
              <option>Entwurf</option>
              <option>Gesendet</option>
              <option>Bezahlt</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col"><label>Zeitraum von</label><input id="i_von" type="date"></div>
          <div class="col"><label>Zeitraum bis</label><input id="i_bis" type="date"></div>
          <div class="col"><label>Fällig am</label><input id="i_due" type="date"></div>
        </div>

        <h3 style="margin:14px 0 8px">Position</h3>
        <label>Leistung</label><input id="l_desc" value="Sicherheitsdienstleistung – Objektbewachung">
        <div class="row">
          <div class="col"><label>Menge (Std.)</label><input id="l_qty" type="number" step="0.01" placeholder="120"></div>
          <div class="col"><label>Preis (€/h)</label><input id="l_price" type="number" step="0.01" placeholder="22"></div>
          <div class="col">
            <label>Netto (auto)</label>
            <input id="l_net" readonly>
          </div>
        </div>

        <div class="kpi">
          <div class="pill"><b>Hinweis:</b> PDF-URL/Datum oben/unten → Print-Dialog: “Headers and footers” AUS</div>
        </div>

        <div class="btns">
          <button class="primary" onclick="printInvoice()">PDF erzeugen</button>
        </div>
      </div>
    </div>

    <!-- ================= PRINT TEMPLATE (hidden until print) ================= -->
    <div id="printRoot"></div>
  </div>

<script>
  // ===== Helpers =====
  const $ = (id) => document.getElementById(id);

  function esc(s){
    return String(s||"").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function toDEFromDateInput(v){
    if(!v) return "";
    const d = new Date(v);
    if (isNaN(d)) return "";
    const dd = String(d.getDate()).padStart(2,"0");
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const yy = d.getFullYear();
    return `${dd}.${mm}.${yy}`;
  }

  function eur(n){
    const x = Number(n||0);
    return x.toLocaleString("de-DE",{minimumFractionDigits:2, maximumFractionDigits:2}) + " €";
  }

  function calc(){
    const qty = Number($("l_qty").value||0);
    const price = Number($("l_price").value||0);
    $("l_net").value = eur(qty * price);
  }

  ["l_qty","l_price"].forEach(id => $(id).addEventListener("input", calc));
  window.addEventListener("load", () => {
    // default today
    const t = new Date();
    const iso = new Date(t.getTime() - t.getTimezoneOffset()*60000).toISOString().slice(0,10);
    if(!$("i_date").value) $("i_date").value = iso;
    calc();
    loadAll();
  });

  // ===== Save/Load =====
  function saveAll(){
    const data = {
      firma: {
        company: $("s_company").value,
        addr: $("s_addr").value,
        email: $("s_email").value,
        taxid: $("s_taxid").value,
        iban: $("s_iban").value,
        bic: $("s_bic").value,
        hint: $("s_hint").value
      },
      kunde: {
        name: $("c_name").value,
        addr: $("c_addr").value,
        email: $("c_email").value
      }
    };
    localStorage.setItem("ms_office_data_v1", JSON.stringify(data));
  }
  function loadAll(){
    const raw = localStorage.getItem("ms_office_data_v1");
    if(!raw) return;
    try{
      const data = JSON.parse(raw);
      if(data.firma){
        $("s_company").value = data.firma.company || "";
        $("s_addr").value = data.firma.addr || "";
        $("s_email").value = data.firma.email || "";
        $("s_taxid").value = data.firma.taxid || "";
        $("s_iban").value = data.firma.iban || "";
        $("s_bic").value = data.firma.bic || "";
        $("s_hint").value = data.firma.hint || "";
      }
      if(data.kunde){
        $("c_name").value = data.kunde.name || "";
        $("c_addr").value = data.kunde.addr || "";
        $("c_email").value = data.kunde.email || "";
      }
    }catch(e){}
    calc();
  }
  function resetAll(){
    localStorage.removeItem("ms_office_data_v1");
    location.reload();
  }

  // ===== Print Invoice =====
  function printInvoice(){
    const firma = {
      company: $("s_company").value,
      addr: $("s_addr").value,
      email: $("s_email").value,
      taxid: $("s_taxid").value,
      iban: $("s_iban").value,
      bic: $("s_bic").value,
      hint: $("s_hint").value
    };
    const kunde = {
      name: $("c_name").value,
      addr: $("c_addr").value,
      email: $("c_email").value
    };
    const inv = {
      no: $("i_no").value,
      date: $("i_date").value,
      von: $("i_von").value,
      bis: $("i_bis").value,
      due: $("i_due").value,
      status: $("i_status").value,
      desc: $("l_desc").value,
      qty: Number($("l_qty").value||0),
      price: Number($("l_price").value||0)
    };
    const net = inv.qty * inv.price;

    // IMPORTANT: Datum hal meel oo kaliya (midig kore) — bidix kore lama qorin.
    const html = `
      <style>
        @page { margin: 12mm; }
        body{ font-family: Arial, Helvetica, sans-serif; color:#000; background:#fff; }
        .page{ padding:0; }
        .top{ display:flex; justify-content:space-between; align-items:flex-start; gap:14px; }
        .title{ font-size:34px; font-weight:800; margin:0 0 4px; }
        .muted{ color:#333; font-size:12px; line-height:1.35; }
        .right{ text-align:right; font-size:12px; line-height:1.35; }
        .line{ border-top:1px solid #bbb; margin:10px 0 12px; }
        .boxes{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
        .box{ border:1px solid #bbb; padding:10px; min-height:64px; }
        .box b{ display:block; margin-bottom:4px; }
        table{ width:100%; border-collapse:collapse; margin-top:10px; }
        th,td{ border-bottom:1px solid #ddd; padding:8px; font-size:12px; }
        th{ text-align:left; }
        .r{ text-align:right; }
        .bottom{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:10px; }
        .sum b{ font-size:14px; }
        a{ color:#000; text-decoration:underline; }
      </style>

      <div class="page">
        <div class="top">
          <div>
            <div class="title">Rechnung</div>
            <div class="muted">
              Rechnungs-Nr.: <b>${esc(inv.no)}</b><br>
              ${inv.von && inv.bis ? `Zeitraum: ${esc(toDEFromDateInput(inv.von))} – ${esc(toDEFromDateInput(inv.bis))}<br>` : ``}
              ${inv.due ? `Fällig: ${esc(toDEFromDateInput(inv.due))}<br>` : ``}
              Status: ${esc(inv.status)}
            </div>
          </div>
          <div class="right">
            <b>${esc(firma.company)}</b><br>
            ${esc(firma.addr).replace(/\\n/g,"<br>")}<br>
            ${firma.email ? `E-Mail: <a href="mailto:${esc(firma.email)}">${esc(firma.email)}</a><br>` : ``}
            ${firma.taxid ? `Steuernummer: ${esc(firma.taxid)}<br>` : ``}
            Datum: <b>${esc(toDEFromDateInput(inv.date))}</b>
          </div>
        </div>

        <div class="line"></div>

        <div class="boxes">
          <div class="box">
            <b>Rechnung von</b>
            ${esc(firma.company)}<br>
            ${esc(firma.addr).replace(/\\n/g,"<br>")}
          </div>

          <div class="box">
            <b>Rechnung an</b>
            ${esc(kunde.name)}<br>
            ${esc(kunde.addr).replace(/\\n/g,"<br>")}
            ${kunde.email ? `<br>E-Mail: <a href="mailto:${esc(kunde.email)}">${esc(kunde.email)}</a>` : ``}
          </div>
        </div>

        <table>
          <tr>
            <th>Leistung</th>
            <th class="r">Menge (Std.)</th>
            <th class="r">Preis (€/h)</th>
            <th class="r">Netto</th>
          </tr>
          <tr>
            <td>${esc(inv.desc)}</td>
            <td class="r">${inv.qty.toLocaleString("de-DE",{minimumFractionDigits:2, maximumFractionDigits:2})}</td>
            <td class="r">${eur(inv.price)}</td>
            <td class="r"><b>${eur(net)}</b></td>
          </tr>
        </table>

        <div class="bottom">
          <div class="box">
            <b>Zahlung</b>
            IBAN: ${esc(firma.iban)}<br>
            BIC: ${esc(firma.bic)}<br>
            <div style="margin-top:6px">${esc(firma.hint||"").replace(/\\n/g,"<br>")}</div>
          </div>

          <div class="box sum">
            <b>Summe</b>
            Summe Netto: <b>${eur(net)}</b><br>
            Zu zahlen: <b>${eur(net)}</b>
          </div>
        </div>
      </div>
    `;

    $("printRoot").innerHTML = html;
    saveAll();

    // Print current page (better than popup windows)
    window.print();
  }
</script>
</body>
</html>

<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Masculine Security â€” Dienstplan</title>
  <meta name="theme-color" content="#0b1220" />
  <style>
    :root{
      --bg:#071225; --panel:#0b1a33; --panel2:#0c2242; --card:#0f2a4f; --line:#16345e;
      --text:#e7f0ff; --muted:#9bb1d5; --accent:#3aa6ff; --good:#21d19f; --warn:#ffce54; --bad:#ff4d6d;
      --r:18px; --r2:12px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      --shadow: 0 16px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--font); color:var(--text);
      background:
        radial-gradient(1100px 650px at 25% -15%, rgba(58,166,255,.22), transparent 60%),
        radial-gradient(900px 600px at 90% 5%, rgba(33,209,159,.14), transparent 55%),
        linear-gradient(180deg, #061022 0%, #071225 100%);
      min-height:100vh;
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px;}
    .top{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 16px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08); border-radius:var(--r); box-shadow:var(--shadow);
      position:sticky; top:0; backdrop-filter: blur(10px); z-index:20;
    }
    .brand{display:flex; align-items:center; gap:12px;}
    .logoBox{
      width:54px; height:54px; border-radius:14px; overflow:hidden;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:center;
    }
    .logoBox img{width:100%; height:100%; object-fit:cover; display:block}
    .logoFallback{
      width:100%; height:100%; display:flex; align-items:center; justify-content:center;
      font-weight:900; letter-spacing:.4px; color:rgba(255,255,255,.75);
      background:linear-gradient(180deg, rgba(58,166,255,.18), rgba(15,42,79,.35));
    }
    h1{margin:0; font-size:16px; letter-spacing:.4px}
    .sub{margin-top:2px; font-size:12px; color:var(--muted)}
    .statusline{font-size:12px; color:var(--muted)}
    .statusline b{color:var(--text)}
    .actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04);
      color:var(--text); padding:9px 12px; border-radius:12px; cursor:pointer;
      font-size:13px;
    }
    .btn.primary{background:rgba(58,166,255,.22); border-color:rgba(58,166,255,.40)}
    .btn.good{background:rgba(33,209,159,.18); border-color:rgba(33,209,159,.35)}
    .btn.bad{background:rgba(255,77,109,.16); border-color:rgba(255,77,109,.30)}
    .grid{display:grid; grid-template-columns:1.15fr .85fr; gap:14px; margin-top:14px}
    @media (max-width: 940px){ .grid{grid-template-columns:1fr} }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .card h2{margin:0 0 10px; font-size:14px; letter-spacing:.3px}
    .muted{color:var(--muted); font-size:12px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 560px){ .row{grid-template-columns:1fr} }
    label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    input, select, textarea{
      width:100%; padding:10px 11px; border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(10,25,50,.55);
      color:var(--text); outline:none;
    }
    textarea{min-height:110px; resize:vertical}
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04); font-size:12px;
    }
    .chip input{width:auto; margin:0}
    .split{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px}
    @media (max-width: 760px){ .split{grid-template-columns:1fr} }
    .divider{height:1px; background:rgba(255,255,255,.08); margin:12px 0}
    .notice{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px; border-radius:12px;
      border:1px dashed rgba(255,255,255,.14);
      background:rgba(255,255,255,.03);
      font-size:12px; color:var(--muted);
    }
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas; font-size:11px; padding:2px 6px; border-radius:8px; border:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.18); color:rgba(255,255,255,.82)}
    .hidden{display:none !important}

    /* PRINT */
    @media print{
      body{background:#fff; color:#000}
      .top, .actions, .notice.no-print{display:none !important}
      .wrap{max-width:none; padding:0}
      .card{box-shadow:none; border:1px solid #d7e7ff; background:#fff}
      input, select, textarea{border:1px solid #c9dcff; background:#fff; color:#000}
      .muted{color:#333}
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="brand">
      <div class="logoBox">
        <img id="logoImg" src="logo.png" alt="Logo"
             onerror="this.style.display='none'; document.getElementById('logoFallback').classList.remove('hidden');" />
        <div id="logoFallback" class="logoFallback hidden">MS</div>
      </div>
      <div>
        <h1>Masculine Security â€” Dienstplan</h1>
        <div class="sub">WhatsApp Text + PDF Export (mit Firmenkopf)</div>
        <div class="statusline">Zuletzt aktualisiert: <span id="lastSaved">â€”</span></div>
      </div>
    </div>

    <div class="actions">
      <button class="btn" id="btnWhatsText">WhatsApp (Text)</button>
      <button class="btn primary" id="btnPdfCompany">PDF (Blau)</button>
      <button class="btn" id="btnWhatsPdfHelp">WhatsApp PDF (Steps)</button>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Wochenplan erstellen</h2>
      <div class="muted">PDF enthÃ¤lt Logo + Firmadaten + Mitarbeiter-Nummer.</div>
      <div class="divider"></div>

      <div class="row">
        <div>
          <label>Mitarbeiter-Name</label>
          <input id="empName" placeholder="z.B. Mustafa" />
        </div>
        <div>
          <label>Mitarbeiter-Nummer</label>
          <input id="empNo" placeholder="z.B. MS-001" />
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <div>
          <label>WhatsApp-Nummer (optional)</label>
          <input id="empPhone" placeholder="z.B. +4915778697052" />
        </div>
        <div>
          <label>Woche / Zeitraum (optional)</label>
          <input id="weekRange" placeholder="z.B. 17.02â€“23.02" />
        </div>
      </div>

      <div class="divider"></div>

      <label>Arbeitstage</label>
      <div class="chips" id="dayChips">
        <label class="chip"><input type="checkbox" value="Mo"> Mo</label>
        <label class="chip"><input type="checkbox" value="Di"> Di</label>
        <label class="chip"><input type="checkbox" value="Mi"> Mi</label>
        <label class="chip"><input type="checkbox" value="Do"> Do</label>
        <label class="chip"><input type="checkbox" value="Fr"> Fr</label>
        <label class="chip"><input type="checkbox" value="Sa"> Sa</label>
        <label class="chip"><input type="checkbox" value="So"> So</label>
      </div>

      <div class="divider"></div>

      <div class="split">
        <div>
          <label>Objekt / Einsatzort</label>
          <input id="objekt" placeholder="z.B. Hotel / Baustelle / Lager" />
        </div>
        <div>
          <label>Schicht</label>
          <select id="shift">
            <option value="Tag">Tag</option>
            <option value="Nacht">Nacht</option>
          </select>
        </div>
        <div>
          <label>Uhrzeit (optional)</label>
          <input id="time" placeholder="z.B. 18:00â€“06:00" />
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <div>
          <label>Ort (optional)</label>
          <input id="location" placeholder="z.B. Bremen" />
        </div>
        <div>
          <label>Notizen (optional)</label>
          <input id="notesLine" placeholder="z.B. Rundgang / SchlÃ¼ssel" />
        </div>
      </div>

      <div class="divider"></div>

      <label>Details (optional)</label>
      <textarea id="notes" placeholder="z.B. Besonderheiten / Anweisung / Ãœbergabe"></textarea>

      <div class="divider"></div>

      <div class="notice no-print">
        <div style="min-width:18px">ðŸ“Œ</div>
        <div>
          <div><b>PDF â†’ WhatsApp:</b> Klick <b>PDF (Blau)</b> â†’ Druckdialog: <b>Als PDF speichern</b> â†’ WhatsApp â†’ Datei senden.</div>
          <div style="margin-top:6px"><span class="kbd">Strg</span> + <span class="kbd">F5</span> wenn Logo nicht aktualisiert.</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Vorschau</h2>
      <div class="muted">WhatsApp-Text + PDF-Text getrennt.</div>
      <div class="divider"></div>

      <label>WhatsApp Text</label>
      <textarea id="previewText" readonly></textarea>

      <div class="divider"></div>

      <label>PDF Text (mit Firmenkopf)</label>
      <textarea id="previewPdf" readonly></textarea>
    </div>
  </div>
</div>

<script>
(() => {
  // === COMPANY DATA (EDIT HERE) ===
  const COMPANY = {
    name: "Masculine Security",
    address: "WerschenregerstraÃŸe 6, 28237 Bremen",
    phone: "015778697052",
    email: "Kontakt.mass.bremen@hotmail.com"
  };

  const $ = (id) => document.getElementById(id);
  const nowStr = () => new Date().toLocaleString("de-DE");
  const normalizePhone = (s) => (s || "").trim().replace(/\s+/g, "");
  const safe = (s) => (s ?? "").toString().trim();

  function selectedDays(){
    const boxes = [...document.querySelectorAll("#dayChips input[type=checkbox]")];
    return boxes.filter(b => b.checked).map(b => b.value);
  }

  const dayFull = {Mo:"Montag",Di:"Dienstag",Mi:"Mittwoch",Do:"Donnerstag",Fr:"Freitag",Sa:"Samstag",So:"Sonntag"};

  function buildPlanLines(){
    const name = safe($("empName").value);
    const empNo = safe($("empNo").value);
    const days = selectedDays();
    const objekt = safe($("objekt").value);
    const shift  = safe($("shift").value);
    const time   = safe($("time").value);
    const week   = safe($("weekRange").value);
    const loc    = safe($("location").value);
    const notes1 = safe($("notesLine").value);
    const notes  = safe($("notes").value);

    let lines = [];
    lines.push("Dienstplan");
    if (name)  lines.push(`Mitarbeiter: ${name}`);
    if (empNo) lines.push(`Mitarbeiter-Nr.: ${empNo}`);
    if (week)  lines.push(`Woche: ${week}`);
    if (loc)   lines.push(`Ort: ${loc}`);
    lines.push("");

    if (days.length){
      for (const d of days){
        let row = `${dayFull[d] || d}: `;
        row += objekt ? `${objekt}` : "Objekt";
        row += ` â€” ${shift || "Schicht"}`;
        if (time) row += ` (${time})`;
        lines.push(row);
      }
    } else {
      lines.push("Tage: (bitte auswÃ¤hlen)");
    }

    const allNotes = [notes1, notes].filter(Boolean).join("\n");
    if (allNotes){
      lines.push("");
      lines.push("Hinweise:");
      lines.push(allNotes);
    }
    return lines;
  }

  function buildWhatsAppText(){
    // includes employee number too
    return buildPlanLines().join("\n");
  }

  function buildPdfText(){
    const lines = [];
    lines.push(COMPANY.name);
    lines.push(COMPANY.address);
    lines.push(`Tel: ${COMPANY.phone} â€¢ E-Mail: ${COMPANY.email}`);
    lines.push("");
    lines.push("----------------------------------------");
    lines.push("");
    lines.push(...buildPlanLines());
    return lines.join("\n");
  }

  function updatePreview(){
    $("previewText").value = buildWhatsAppText();
    $("previewPdf").value  = buildPdfText();
    $("lastSaved").textContent = nowStr();
  }

  ["empName","empNo","empPhone","objekt","shift","time","weekRange","location","notesLine","notes"].forEach(id=>{
    $(id).addEventListener("input", updatePreview);
    $(id).addEventListener("change", updatePreview);
  });
  [...document.querySelectorAll("#dayChips input[type=checkbox]")].forEach(cb=>{
    cb.addEventListener("change", updatePreview);
  });

  function sendWhatsAppText(text, phone){
    const enc = encodeURIComponent(text);
    const p = normalizePhone(phone);
    const url = p ? `https://wa.me/${p.replace(/^\+/, "")}?text=${enc}` : `https://wa.me/?text=${enc}`;
    window.open(url, "_blank", "noopener,noreferrer");
  }

  $("btnWhatsText").addEventListener("click", () => {
    const msg = buildWhatsAppText();
    const phone = normalizePhone($("empPhone").value);
    sendWhatsAppText(msg, phone);
  });

  $("btnPdfCompany").addEventListener("click", () => {
    const pdfText = buildPdfText();
    openPrintWindow("Dienstplan (PDF)", pdfText, true);
  });

  $("btnWhatsPdfHelp").addEventListener("click", () => {
    alert(
`WhatsApp PDF senden:
1) Klick: "PDF (Blau)"
2) Druckdialog â†’ Ziel: "Als PDF speichern" â†’ Speichern
3) WhatsApp Ã¶ffnen â†’ Datei senden (PDF auswÃ¤hlen)

Hinweis: Website kann PDF nicht automatisch direkt senden.`
    );
  });

  function openPrintWindow(title, text, autoPrint=false){
    const w = window.open("", "_blank", "noopener,noreferrer");
    if (!w){ alert("Popup blockiert. Bitte Popups erlauben und erneut versuchen."); return; }

    const esc = (s) => (s||"").replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));
    w.document.open();
    w.document.write(`
      <!doctype html>
      <html><head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>${esc(title)}</title>
        <style>
          :root{
            --blue:#2b7cff;
            --blue2:#eaf3ff;
            --border:#b9d6ff;
            --text:#0b1526;
            --muted:#2c3a55;
          }
          body{font-family:Arial, sans-serif; margin:0; color:var(--text); background:#fff}
          .header{
            background: linear-gradient(180deg, var(--blue2), #ffffff);
            border-bottom: 2px solid var(--border);
            padding: 18px 22px;
            display:flex; gap:14px; align-items:center;
          }
          .logo{
            width:66px; height:66px; border-radius:14px; overflow:hidden;
            border:1px solid var(--border); background:#fff;
            display:flex; align-items:center; justify-content:center;
          }
          .logo img{width:100%; height:100%; object-fit:cover; display:block}
          .h1{font-weight:900; font-size:18px; color:#0b1b35; margin:0}
          .meta{font-size:12px; color:var(--muted); margin-top:3px}
          .content{padding:18px 22px}
          .box{
            border:1px solid var(--border);
            border-left:6px solid var(--blue);
            border-radius:14px;
            padding:16px;
            background:#fff;
          }
          pre{white-space:pre-wrap; font-size:14px; line-height:1.35; margin:0}
          .tip{margin-top:12px; font-size:12px; color:#556}
          @media print{ .tip{display:none} }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="logo"><img src="logo.png" alt="Logo" onerror="this.style.display='none'"></div>
          <div>
            <div class="h1">${esc(COMPANY.name)}</div>
            <div class="meta">${esc(COMPANY.address)}</div>
            <div class="meta">Tel: ${esc(COMPANY.phone)} â€¢ E-Mail: ${esc(COMPANY.email)}</div>
            <div class="meta">Erstellt: ${esc(new Date().toLocaleString("de-DE"))}</div>
          </div>
        </div>

        <div class="content">
          <div class="box"><pre>${esc(text)}</pre></div>
          <div class="tip">Im Druckdialog: Ziel â†’ "Als PDF speichern"</div>
        </div>

        <script>
          ${autoPrint ? "window.onload = () => { window.focus(); window.print(); };" : ""}
        <\/script>
      </body></html>
    `);
    w.document.close();
  }

  updatePreview();
})();
</script>
</body>
</html>
